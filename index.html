<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simulator - Enhanced</title>
    <meta name="description" content="A comprehensive test-taking application with timer, progress saving, and accessibility features">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#21808D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Test Simulator">
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icon-192.svg">
    <link rel="apple-touch-icon" href="icon-192.svg">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="theme-toggle-btn" aria-label="Open theme menu">üé®</button>

    <!-- Theme Menu -->
    <div id="theme-menu" class="theme-menu hidden" role="menu" aria-label="Theme selection">
        <div class="theme-menu-header">Choose Theme</div>
        <button class="theme-option" data-theme="light" role="menuitem">
            <span class="theme-icon">‚òÄÔ∏è</span>
            <span>Perplexity Light</span>
        </button>
        <button class="theme-option" data-theme="dark" role="menuitem">
            <span class="theme-icon">üåô</span>
            <span>Perplexity Dark</span>
        </button>
        <button class="theme-option" data-theme="claude-light" role="menuitem">
            <span class="theme-icon">üß°</span>
            <span>Claude Light</span>
        </button>
        <button class="theme-option" data-theme="claude-dark" role="menuitem">
            <span class="theme-icon">üü†</span>
            <span>Claude Dark</span>
        </button>
    </div>

    <div class="container">
        <!-- JSON Input Section -->
        <div id="json-input-section" class="section">
            <div class="card">
                <div class="card__body">
                    <h1>Test Simulator</h1>
                    <p class="text-secondary">Paste your test JSON data below to load a test</p>

                    <!-- Timer Settings -->
                    <div class="timer-settings-container">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="timer-toggle">
                                <span>Enable timer</span>
                            </label>
                        </div>
                        <div id="timer-settings" class="hidden">
                            <div class="form-group">
                                <label for="timer-duration" class="form-label">Duration (minutes)</label>
                                <input
                                    type="number"
                                    id="timer-duration"
                                    class="form-control"
                                    value="30"
                                    min="1"
                                    max="180"
                                    aria-label="Test duration in minutes"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="json-input" class="form-label">Test JSON Data</label>
                        <textarea
                            id="json-input"
                            class="form-control"
                            rows="10"
                            aria-label="Test JSON data input"
                            placeholder='Paste your test JSON here...

Example format:
{
  "title": "Sample Test",
  "questions": [
    {
      "id": 1,
      "type": "mcq",
      "question": "Question text",
      "options": ["A", "B", "C", "D"],
      "correct": 1
    }
  ]
}'></textarea>
                    </div>

                    <div id="error-message" class="error-message hidden" aria-live="assertive"></div>

                    <div class="button-group">
                        <button id="load-test-btn" class="btn btn--primary">Load Test</button>
                        <button id="load-sample-btn" class="btn btn--outline">Load Sample Test</button>
                        <button id="open-library-btn" class="btn btn--secondary">üìö My Saved Tests</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Library Section -->
        <div id="test-library-section" class="section hidden">
            <div class="library-header">
                <h1>My Test Library</h1>
                <button id="close-library-btn" class="btn btn--outline">‚Üê Back</button>
            </div>

            <div class="library-controls">
                <input
                    type="text"
                    id="library-search"
                    class="form-control library-search"
                    placeholder="üîç Search tests..."
                    aria-label="Search tests"
                >
                <div class="library-filters">
                    <select id="library-course-filter" class="form-control" aria-label="Filter by course">
                        <option value="">All Courses</option>
                    </select>
                    <select id="library-topic-filter" class="form-control" aria-label="Filter by topic">
                        <option value="">All Topics</option>
                    </select>
                </div>
            </div>

            <div id="test-library-grid" class="test-library-grid">
                <!-- Test cards will be inserted here -->
            </div>
        </div>

        <!-- Test Section -->
        <div id="test-section" class="section hidden">
            <div class="test-header">
                <div class="test-header-left">
                    <h2 id="test-title">Test Title</h2>
                    <div class="progress-indicator">
                        <span id="question-counter">Question 1 of 10</span>
                    </div>
                </div>
                <div class="timer-container hidden" aria-live="polite">
                    <span class="timer-label">Time Remaining:</span>
                    <span id="timer-display" class="timer-display">30:00</span>
                </div>
            </div>

            <div class="test-content-grid">
                <!-- Question Overview Panel -->
                <aside class="question-overview-panel" aria-label="Question navigation">
                    <div id="question-overview"></div>
                </aside>

                <!-- Main Question Area -->
                <main class="question-main">
                    <div class="card">
                        <div class="card__body">
                            <div id="question-container" role="main" aria-live="polite">
                                <!-- Question content will be inserted here -->
                            </div>

                            <div class="navigation-buttons">
                                <button
                                    id="prev-btn"
                                    class="btn btn--outline"
                                    disabled
                                    aria-label="Previous question"
                                >
                                    Previous
                                </button>
                                <div class="nav-buttons-right">
                                    <button
                                        id="next-btn"
                                        class="btn btn--primary"
                                        aria-label="Next question"
                                    >
                                        Next
                                    </button>
                                    <button
                                        id="submit-btn"
                                        class="btn btn--primary hidden"
                                        aria-label="Submit test"
                                    >
                                        Submit Test
                                    </button>
                                </div>
                            </div>

                            <div class="keyboard-hints">
                                <p class="hint-text">
                                    <strong>Keyboard shortcuts:</strong>
                                    ‚Üê Previous | ‚Üí Next | Ctrl+Enter Submit
                                </p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="section hidden">
            <div class="card">
                <div class="card__body">
                    <h2>Test Results</h2>
                    <div id="score-summary" class="score-summary">
                        <!-- Score will be inserted here -->
                    </div>

                    <div class="export-buttons">
                        <button id="save-test-btn" class="btn btn--primary" aria-label="Save test to library">
                            üíæ Save Test
                        </button>
                        <button id="export-pdf-btn" class="btn btn--secondary" aria-label="Export results as PDF">
                            üìÑ Export as PDF
                        </button>
                        <button id="export-csv-btn" class="btn btn--secondary" aria-label="Export results as CSV">
                            üìä Export as CSV
                        </button>
                    </div>

                    <h3>Review</h3>
                    <div id="results-review" role="region" aria-label="Answer review">
                        <!-- Detailed results will be inserted here -->
                    </div>

                    <div class="button-group">
                        <button id="restart-btn" class="btn btn--primary">Load New Test</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden" role="dialog" aria-labelledby="confirm-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirm-modal-title">Confirm Submission</h3>
            </div>
            <div class="modal-body">
                <p class="confirm-message">Are you sure you want to submit your test?</p>
                <div class="button-group">
                    <button id="confirm-submit-btn" class="btn btn--primary">Yes, Submit</button>
                    <button id="cancel-submit-btn" class="btn btn--outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Test Modal -->
    <div id="save-test-modal" class="modal hidden" role="dialog" aria-labelledby="save-test-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="save-test-modal-title">Save Test to Library</h3>
            </div>
            <div class="modal-body">
                <p>Save this test to your library for easy access later.</p>
                <div class="form-group">
                    <label for="save-test-title" class="form-label">Test Title *</label>
                    <input
                        type="text"
                        id="save-test-title"
                        class="form-control"
                        placeholder="e.g., Midterm Practice"
                        required
                        aria-label="Test title"
                    >
                </div>
                <div class="form-group">
                    <label for="save-test-course" class="form-label">Course *</label>
                    <input
                        type="text"
                        id="save-test-course"
                        class="form-control"
                        placeholder="e.g., CS101, MATH201"
                        required
                        aria-label="Course name"
                    >
                </div>
                <div class="form-group">
                    <label for="save-test-topic" class="form-label">Topic (optional)</label>
                    <input
                        type="text"
                        id="save-test-topic"
                        class="form-control"
                        placeholder="e.g., Algorithms, Calculus"
                        aria-label="Topic"
                    >
                </div>
                <div class="button-group">
                    <button id="save-test-form-btn" class="btn btn--primary">üíæ Save</button>
                    <button id="cancel-save-btn" class="btn btn--outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Instructions Modal -->
    <div id="prompt-modal" class="modal hidden" role="dialog" aria-labelledby="prompt-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="prompt-modal-title">AI Test Generation Prompt</h3>
                <button id="close-modal" class="close-btn" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Use this prompt to generate test JSON data with an AI:</p>
                <div class="prompt-box">
                    <code>Generate a test with [NUMBER] questions in JSON format. Include a mix of MCQ (multiple choice), multi-select, and matching questions about [TOPIC]. Use this exact structure:

{
  "title": "Test Title Here",
  "questions": [
    {
      "id": 1,
      "type": "mcq",
      "question": "Question text here",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": 0
    },
    {
      "id": 2,
      "type": "multi-select",
      "question": "Question text here (select all that apply)",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": [0, 2]
    },
    {
      "id": 3,
      "type": "matching",
      "question": "Match the following",
      "leftItems": ["Item 1", "Item 2", "Item 3"],
      "rightItems": ["Match A", "Match B", "Match C"],
      "correct": [0, 1, 2]
    }
  ]
}

For MCQ: correct is the index (0-based) of the correct option
For multi-select: correct is an array of indices of correct options
For matching: correct is an array where each index corresponds to the rightItems index for each leftItem</code>
                </div>
                <p><strong>Example:</strong> "Generate a test with 5 questions in JSON format. Include a mix of MCQ, multi-select, and matching questions about web development."</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden" role="status" aria-live="polite">
        <div class="loading-spinner"></div>
        <p class="loading-message">Loading...</p>
    </div>

    <button id="show-prompt-btn" class="floating-help-btn" aria-label="Show AI generation prompt">?</button>

    <!-- PWA Install Prompt -->
    <div id="install-prompt" class="install-prompt hidden">
        <div class="install-prompt-content">
            <h3>Install Test Simulator</h3>
            <p>Install this app on your device for offline access and a native app experience!</p>
            <div class="button-group">
                <button id="install-btn" class="btn btn--primary">Install</button>
                <button id="dismiss-install-btn" class="btn btn--outline">Not Now</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const dismissInstallBtn = document.getElementById('dismiss-install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the default install prompt
            e.preventDefault();
            deferredPrompt = e;

            // Show custom install prompt (after 3 seconds)
            setTimeout(() => {
                if (localStorage.getItem('installPromptDismissed') !== 'true') {
                    installPrompt?.classList.remove('hidden');
                }
            }, 3000);
        });

        installBtn?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User ${outcome} the install prompt`);
                deferredPrompt = null;
                installPrompt?.classList.add('hidden');
            }
        });

        dismissInstallBtn?.addEventListener('click', () => {
            installPrompt?.classList.add('hidden');
            localStorage.setItem('installPromptDismissed', 'true');
        });

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            installPrompt?.classList.add('hidden');
        });
    </script>
</body>
</html>
