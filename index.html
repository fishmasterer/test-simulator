<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simulator - Enhanced</title>
    <meta name="description" content="A comprehensive test-taking application with timer, progress saving, and accessibility features">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#21808D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Test Simulator">
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="theme-toggle-btn" aria-label="Open theme menu">üé®</button>

    <!-- Theme Menu -->
    <div id="theme-menu" class="theme-menu hidden" role="menu" aria-label="Theme selection">
        <div class="theme-menu-header">Choose Theme</div>
        <button class="theme-option" data-theme="light" role="menuitem">
            <span class="theme-icon">‚òÄÔ∏è</span>
            <span>Perplexity Light</span>
        </button>
        <button class="theme-option" data-theme="dark" role="menuitem">
            <span class="theme-icon">üåô</span>
            <span>Perplexity Dark</span>
        </button>
        <button class="theme-option" data-theme="claude-light" role="menuitem">
            <span class="theme-icon">üß°</span>
            <span>Claude Light</span>
        </button>
        <button class="theme-option" data-theme="claude-dark" role="menuitem">
            <span class="theme-icon">üü†</span>
            <span>Claude Dark</span>
        </button>
    </div>

    <!-- Auth Header -->
    <div id="auth-header" class="auth-header">
        <div class="auth-container">
            <!-- Not signed in state -->
            <div id="auth-signed-out" class="auth-state">
                <div class="auth-message">
                    <span class="auth-icon">‚òÅÔ∏è</span>
                    <span>Sign in to sync your tests across devices</span>
                </div>
                <button id="sign-in-btn" class="btn btn--primary btn--sm">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>
            </div>

            <!-- Signed in state -->
            <div id="auth-signed-in" class="auth-state hidden">
                <div class="auth-user-info">
                    <img id="auth-user-photo" class="auth-user-photo" src="" alt="User photo">
                    <div class="auth-user-details">
                        <span id="auth-user-name" class="auth-user-name"></span>
                        <div class="auth-sync-status">
                            <span id="sync-indicator" class="sync-indicator" title="Synced">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Synced
                            </span>
                        </div>
                    </div>
                </div>
                <button id="sign-out-btn" class="btn btn--outline btn--sm">Sign out</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Landing Section -->
        <div id="landing-section" class="section landing-section">
            <div class="landing-content">
                <div class="landing-decorative-top">
                    <svg class="decorative-branch" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10,50 Q30,30 50,50 T90,50" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="25" cy="38" r="3" fill="currentColor" opacity="0.6"/>
                        <circle cx="45" cy="62" r="2.5" fill="currentColor" opacity="0.5"/>
                        <circle cx="70" cy="38" r="3.5" fill="currentColor" opacity="0.6"/>
                    </svg>
                </div>

                <div class="landing-hero">
                    <h1 class="landing-title">Welcome to Your Study Space</h1>
                    <p class="landing-subtitle">A gentle place to practice, learn, and grow</p>
                </div>

                <div class="landing-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <h3>Practice at Your Pace</h3>
                        <p>Take your time with custom tests designed to support your learning journey</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <h3>Your Personal Library</h3>
                        <p>Save and organize your tests in one cozy place, accessible anytime</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <h3>Mindful Focus Timer</h3>
                        <p>Study sessions paired with gentle breaks to keep you refreshed</p>
                    </div>
                </div>

                <div class="landing-cta">
                    <button id="get-started-btn" class="btn btn--primary btn--large landing-btn">Begin Your Study Session</button>
                    <p class="landing-hint">No account needed to start. Sign in anytime to save your progress.</p>
                </div>

                <div class="landing-decorative-bottom">
                    <svg class="decorative-dots" viewBox="0 0 100 20" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="10" cy="10" r="2" fill="currentColor" opacity="0.3"/>
                        <circle cx="30" cy="10" r="2" fill="currentColor" opacity="0.4"/>
                        <circle cx="50" cy="10" r="2" fill="currentColor" opacity="0.5"/>
                        <circle cx="70" cy="10" r="2" fill="currentColor" opacity="0.4"/>
                        <circle cx="90" cy="10" r="2" fill="currentColor" opacity="0.3"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- JSON Input Section -->
        <div id="json-input-section" class="section hidden">
            <div class="card">
                <div class="card__body">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-12);">
                        <div>
                            <h1 style="margin-bottom: var(--space-8);">Test Simulator</h1>
                            <p class="text-secondary">Paste your test JSON data below to load a test</p>
                        </div>
                        <button id="back-to-landing-btn" class="btn btn--outline btn--sm" style="flex-shrink: 0;">Back to Welcome</button>
                    </div>

                    <!-- Timer Settings -->
                    <div class="timer-settings-container">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="timer-toggle">
                                <span>Enable timer</span>
                            </label>
                        </div>
                        <div id="timer-settings" class="hidden">
                            <div class="form-group">
                                <label for="timer-duration" class="form-label">Duration (minutes)</label>
                                <input
                                    type="number"
                                    id="timer-duration"
                                    class="form-control"
                                    value="30"
                                    min="1"
                                    max="180"
                                    aria-label="Test duration in minutes"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="json-input" class="form-label">Test JSON Data</label>
                        <textarea
                            id="json-input"
                            class="form-control"
                            rows="10"
                            aria-label="Test JSON data input"
                            placeholder='Paste your test JSON here...

Example format:
{
  "title": "Sample Test",
  "questions": [
    {
      "id": 1,
      "type": "mcq",
      "question": "Question text",
      "options": ["A", "B", "C", "D"],
      "correct": 1
    }
  ]
}'></textarea>
                    </div>

                    <div id="error-message" class="error-message hidden" aria-live="assertive"></div>

                    <div class="button-group">
                        <button id="load-test-btn" class="btn btn--primary">Load Test</button>
                        <button id="load-sample-btn" class="btn btn--outline">Load Sample Test</button>
                    </div>

                    <div class="button-group" style="margin-top: var(--space-12);">
                        <button id="open-library-btn" class="btn btn--secondary">üìö My Saved Tests</button>
                        <button id="open-pomodoro-btn" class="btn btn--secondary">üçÖ Focus Timer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Library Section -->
        <div id="test-library-section" class="section hidden">
            <div class="library-header">
                <h1>My Test Library</h1>
                <button id="close-library-btn" class="btn btn--outline">‚Üê Back</button>
            </div>

            <!-- Sync Status Banner -->
            <div id="library-sync-status" class="sync-status-banner hidden">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <span id="library-sync-message">Tests are saved locally only. Sign in to sync across devices.</span>
            </div>

            <div class="library-controls">
                <input
                    type="text"
                    id="library-search"
                    class="form-control library-search"
                    placeholder="üîç Search tests..."
                    aria-label="Search tests"
                >
                <div class="library-filters">
                    <select id="library-course-filter" class="form-control" aria-label="Filter by course">
                        <option value="">All Courses</option>
                    </select>
                    <select id="library-topic-filter" class="form-control" aria-label="Filter by topic">
                        <option value="">All Topics</option>
                    </select>
                </div>
            </div>

            <div id="test-library-grid" class="test-library-grid">
                <!-- Test cards will be inserted here -->
            </div>
        </div>

        <!-- Pomodoro Timer Section -->
        <div id="pomodoro-section" class="section hidden">
            <div class="library-header">
                <h1>üçÖ Focus Timer</h1>
                <button id="close-pomodoro-btn" class="btn btn--outline">‚Üê Back</button>
            </div>

            <div class="pomodoro-container">
                <!-- Timer Display -->
                <div class="pomodoro-timer-card">
                    <div class="pomodoro-mode-indicator">
                        <span id="pomodoro-mode-text">Work Session</span>
                        <span id="pomodoro-session-count">Session 1 of 4</span>
                    </div>

                    <!-- Circular Timer -->
                    <div class="pomodoro-timer-circle">
                        <svg class="pomodoro-progress-ring" viewBox="0 0 280 280" width="100%" height="100%">
                            <circle
                                class="pomodoro-progress-ring-bg"
                                stroke="var(--color-border)"
                                stroke-width="12"
                                fill="transparent"
                                r="130"
                                cx="140"
                                cy="140"
                            />
                            <circle
                                id="pomodoro-progress-ring-fill"
                                class="pomodoro-progress-ring-fill"
                                stroke="var(--color-primary)"
                                stroke-width="12"
                                fill="transparent"
                                r="130"
                                cx="140"
                                cy="140"
                                stroke-dasharray="816.814 816.814"
                                stroke-dashoffset="0"
                                transform="rotate(-90 140 140)"
                            />
                        </svg>
                        <div class="pomodoro-timer-text">
                            <div id="pomodoro-time-display" class="pomodoro-time-display">25:00</div>
                            <div id="pomodoro-current-task" class="pomodoro-current-task">No task selected</div>
                        </div>
                    </div>

                    <!-- Timer Controls -->
                    <div class="pomodoro-controls">
                        <button id="pomodoro-start-btn" class="btn btn--primary btn--large">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            Start
                        </button>
                        <button id="pomodoro-pause-btn" class="btn btn--outline btn--large hidden">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                            </svg>
                            Pause
                        </button>
                        <button id="pomodoro-reset-btn" class="btn btn--outline">Reset</button>
                        <button id="pomodoro-skip-btn" class="btn btn--outline">Skip</button>
                    </div>
                </div>

                <!-- Sidebar with Tasks and Settings -->
                <div class="pomodoro-sidebar">
                    <!-- Quick Tasks -->
                    <div class="pomodoro-panel">
                        <h3>Today's Tasks</h3>
                        <div id="pomodoro-task-list" class="pomodoro-task-list">
                            <!-- Tasks will be inserted here -->
                        </div>
                        <button id="pomodoro-add-task-btn" class="btn btn--outline btn--sm" style="width: 100%;">+ Add Task</button>
                    </div>

                    <!-- Quick Stats -->
                    <div class="pomodoro-panel">
                        <h3>Today's Progress</h3>
                        <div class="pomodoro-stats">
                            <div class="pomodoro-stat-item">
                                <span class="pomodoro-stat-value" id="pomodoro-today-sessions">0</span>
                                <span class="pomodoro-stat-label">Sessions</span>
                            </div>
                            <div class="pomodoro-stat-item">
                                <span class="pomodoro-stat-value" id="pomodoro-today-time">0m</span>
                                <span class="pomodoro-stat-label">Focus Time</span>
                            </div>
                        </div>
                        <button id="pomodoro-view-analytics-btn" class="btn btn--outline btn--sm" style="width: 100%; margin-top: var(--space-12);">
                            View Analytics
                        </button>
                    </div>

                    <!-- Settings -->
                    <div class="pomodoro-panel">
                        <h3>Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Work Duration (min)</label>
                            <input type="number" id="pomodoro-work-duration" class="form-control" value="25" min="1" max="60">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Break Duration (min)</label>
                            <input type="number" id="pomodoro-break-duration" class="form-control" value="5" min="1" max="30">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Long Break (min)</label>
                            <input type="number" id="pomodoro-long-break-duration" class="form-control" value="15" min="1" max="60">
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="pomodoro-auto-start-breaks" checked>
                                <span>Auto-start breaks</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="pomodoro-auto-start-pomodoros">
                                <span>Auto-start work sessions</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="pomodoro-notifications" checked>
                                <span>Enable notifications</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Add Task Modal -->
        <div id="pomodoro-task-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Study Task</h3>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Task Name</label>
                        <input type="text" id="pomodoro-task-name" class="form-control" placeholder="e.g., Study for CS101 Midterm">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estimated Pomodoros</label>
                        <input type="number" id="pomodoro-task-estimate" class="form-control" value="4" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Course (optional)</label>
                        <input type="text" id="pomodoro-task-course" class="form-control" placeholder="e.g., CS101">
                    </div>
                    <div class="button-group">
                        <button id="pomodoro-save-task-btn" class="btn btn--primary">Add Task</button>
                        <button id="pomodoro-cancel-task-btn" class="btn btn--outline">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Analytics Modal -->
        <div id="pomodoro-analytics-modal" class="modal hidden">
            <div class="modal-content modal-content--large">
                <div class="modal-header">
                    <h3>Focus Analytics</h3>
                    <button id="close-analytics-modal-btn" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="analytics-summary">
                        <div class="analytics-card">
                            <h4>This Week</h4>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-week-sessions">0</span>
                                <span class="analytics-stat-label">Sessions</span>
                            </div>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-week-time">0h 0m</span>
                                <span class="analytics-stat-label">Focus Time</span>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>This Month</h4>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-month-sessions">0</span>
                                <span class="analytics-stat-label">Sessions</span>
                            </div>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-month-time">0h 0m</span>
                                <span class="analytics-stat-label">Focus Time</span>
                            </div>
                        </div>
                        <div class="analytics-card">
                            <h4>All Time</h4>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-total-sessions">0</span>
                                <span class="analytics-stat-label">Sessions</span>
                            </div>
                            <div class="analytics-stat">
                                <span class="analytics-stat-value" id="analytics-total-time">0h 0m</span>
                                <span class="analytics-stat-label">Focus Time</span>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-section">
                        <h4>Recent Sessions</h4>
                        <div id="analytics-recent-sessions" class="analytics-session-list">
                            <!-- Recent sessions will be inserted here -->
                        </div>
                    </div>

                    <div class="analytics-section">
                        <h4>Task Breakdown</h4>
                        <div id="analytics-task-breakdown" class="analytics-task-list">
                            <!-- Task breakdown will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Section -->
        <div id="test-section" class="section hidden">
            <div class="test-header">
                <div class="test-header-left">
                    <h2 id="test-title">Test Title</h2>
                    <div class="progress-indicator">
                        <span id="question-counter">Question 1 of 10</span>
                    </div>
                </div>
                <div class="timer-container hidden" aria-live="polite">
                    <span class="timer-label">Time Remaining:</span>
                    <span id="timer-display" class="timer-display">30:00</span>
                </div>
            </div>

            <div class="test-content-grid">
                <!-- Question Overview Panel -->
                <aside class="question-overview-panel" aria-label="Question navigation">
                    <div id="question-overview"></div>
                </aside>

                <!-- Main Question Area -->
                <main class="question-main">
                    <div class="card">
                        <div class="card__body">
                            <div id="question-container" role="main" aria-live="polite">
                                <!-- Question content will be inserted here -->
                            </div>

                            <div class="navigation-buttons">
                                <button
                                    id="prev-btn"
                                    class="btn btn--outline"
                                    disabled
                                    aria-label="Previous question"
                                >
                                    Previous
                                </button>
                                <div class="nav-buttons-right">
                                    <button
                                        id="next-btn"
                                        class="btn btn--primary"
                                        aria-label="Next question"
                                    >
                                        Next
                                    </button>
                                    <button
                                        id="submit-btn"
                                        class="btn btn--primary hidden"
                                        aria-label="Submit test"
                                    >
                                        Submit Test
                                    </button>
                                </div>
                            </div>

                            <div class="keyboard-hints">
                                <p class="hint-text">
                                    <strong>Keyboard shortcuts:</strong>
                                    ‚Üê Previous | ‚Üí Next | Ctrl+Enter Submit
                                </p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="section hidden">
            <div class="card">
                <div class="card__body">
                    <h2>Test Results</h2>
                    <div id="score-summary" class="score-summary">
                        <!-- Score will be inserted here -->
                    </div>

                    <div class="export-buttons">
                        <button id="save-test-btn" class="btn btn--primary" aria-label="Save test to library">
                            üíæ Save Test
                        </button>
                        <button id="export-pdf-btn" class="btn btn--secondary" aria-label="Export results as PDF">
                            üìÑ Export as PDF
                        </button>
                        <button id="export-csv-btn" class="btn btn--secondary" aria-label="Export results as CSV">
                            üìä Export as CSV
                        </button>
                    </div>

                    <h3>Review</h3>
                    <div id="results-review" role="region" aria-label="Answer review">
                        <!-- Detailed results will be inserted here -->
                    </div>

                    <div class="button-group">
                        <button id="restart-btn" class="btn btn--primary">Load New Test</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden" role="dialog" aria-labelledby="confirm-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirm-modal-title">Confirm Submission</h3>
            </div>
            <div class="modal-body">
                <p class="confirm-message">Are you sure you want to submit your test?</p>
                <div class="button-group">
                    <button id="confirm-submit-btn" class="btn btn--primary">Yes, Submit</button>
                    <button id="cancel-submit-btn" class="btn btn--outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Test Modal -->
    <div id="save-test-modal" class="modal hidden" role="dialog" aria-labelledby="save-test-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="save-test-modal-title">Save Test to Library</h3>
            </div>
            <div class="modal-body">
                <p>Save this test to your library for easy access later.</p>
                <div class="form-group">
                    <label for="save-test-title" class="form-label">Test Title *</label>
                    <input
                        type="text"
                        id="save-test-title"
                        class="form-control"
                        placeholder="e.g., Midterm Practice"
                        required
                        aria-label="Test title"
                    >
                </div>
                <div class="form-group">
                    <label for="save-test-course" class="form-label">Course *</label>
                    <input
                        type="text"
                        id="save-test-course"
                        class="form-control"
                        placeholder="e.g., CS101, MATH201"
                        required
                        aria-label="Course name"
                    >
                </div>
                <div class="form-group">
                    <label for="save-test-topic" class="form-label">Topic (optional)</label>
                    <input
                        type="text"
                        id="save-test-topic"
                        class="form-control"
                        placeholder="e.g., Algorithms, Calculus"
                        aria-label="Topic"
                    >
                </div>
                <div class="button-group">
                    <button id="save-test-form-btn" class="btn btn--primary">üíæ Save</button>
                    <button id="cancel-save-btn" class="btn btn--outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Test Modal -->
    <div id="share-test-modal" class="modal hidden" role="dialog" aria-labelledby="share-test-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="share-test-modal-title">Share Test with Classmates</h3>
            </div>
            <div class="modal-body">
                <p>Share this test with your classmates. They can use the code to access it.</p>
                <div id="share-code-display" class="share-code-display hidden">
                    <div class="share-code-label">Share Code:</div>
                    <div id="share-code-value" class="share-code-value"></div>
                    <button id="copy-share-code-btn" class="btn btn--outline btn--sm">üìã Copy Code</button>
                </div>
                <div class="button-group">
                    <button id="generate-share-code-btn" class="btn btn--primary">Generate Share Code</button>
                    <button id="publish-to-community-btn" class="btn btn--secondary">Publish to Community</button>
                    <button id="close-share-modal-btn" class="btn btn--outline">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Access Shared Test Modal -->
    <div id="access-shared-modal" class="modal hidden" role="dialog" aria-labelledby="access-shared-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="access-shared-modal-title">Access Shared Test</h3>
            </div>
            <div class="modal-body">
                <p>Enter the share code you received from a classmate to access their test.</p>
                <div class="form-group">
                    <label for="shared-test-code" class="form-label">Share Code</label>
                    <input
                        type="text"
                        id="shared-test-code"
                        class="form-control"
                        placeholder="e.g., ABC123"
                        style="text-transform: uppercase;"
                        maxlength="6"
                        aria-label="Share code"
                    >
                </div>
                <div class="button-group">
                    <button id="load-shared-test-btn" class="btn btn--primary">Load Test</button>
                    <button id="close-access-shared-modal-btn" class="btn btn--outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Community Browser Modal -->
    <div id="community-browser-modal" class="modal hidden" role="dialog" aria-labelledby="community-browser-modal-title" aria-modal="true">
        <div class="modal-content modal-content--large">
            <div class="modal-header">
                <h3 id="community-browser-modal-title">Community Test Library</h3>
                <button id="close-community-modal-btn" class="close-btn" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="library-controls">
                    <input
                        type="text"
                        id="community-search"
                        class="form-control library-search"
                        placeholder="üîç Search community tests..."
                        aria-label="Search community tests"
                    >
                    <div class="library-filters">
                        <select id="community-course-filter" class="form-control" aria-label="Filter by course">
                            <option value="">All Courses</option>
                        </select>
                        <select id="community-topic-filter" class="form-control" aria-label="Filter by topic">
                            <option value="">All Topics</option>
                        </select>
                    </div>
                </div>
                <div id="community-grid" class="test-library-grid">
                    <!-- Community tests dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Instructions Modal -->
    <div id="prompt-modal" class="modal hidden" role="dialog" aria-labelledby="prompt-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="prompt-modal-title">AI Test Generation Prompt</h3>
                <button id="close-modal" class="close-btn" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Use this prompt to generate test JSON data with an AI:</p>
                <div class="prompt-box">
                    <code>Generate a test with [NUMBER] questions in JSON format. Include a mix of MCQ (multiple choice), multi-select, and matching questions about [TOPIC]. Use this exact structure:

{
  "title": "Test Title Here",
  "questions": [
    {
      "id": 1,
      "type": "mcq",
      "question": "Question text here",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": 0
    },
    {
      "id": 2,
      "type": "multi-select",
      "question": "Question text here (select all that apply)",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": [0, 2]
    },
    {
      "id": 3,
      "type": "matching",
      "question": "Match the following",
      "leftItems": ["Item 1", "Item 2", "Item 3"],
      "rightItems": ["Match A", "Match B", "Match C"],
      "correct": [0, 1, 2]
    }
  ]
}

For MCQ: correct is the index (0-based) of the correct option
For multi-select: correct is an array of indices of correct options
For matching: correct is an array where each index corresponds to the rightItems index for each leftItem</code>
                </div>
                <p><strong>Example:</strong> "Generate a test with 5 questions in JSON format. Include a mix of MCQ, multi-select, and matching questions about web development."</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden" role="status" aria-live="polite">
        <div class="loading-spinner"></div>
        <p class="loading-message">Loading...</p>
    </div>

    <button id="show-prompt-btn" class="floating-help-btn" aria-label="Show AI generation prompt">?</button>

    <!-- PWA Install Prompt -->
    <div id="install-prompt" class="install-prompt hidden">
        <div class="install-prompt-content">
            <h3>Install Test Simulator</h3>
            <p>Install this app on your device for offline access and a native app experience!</p>
            <div class="button-group">
                <button id="install-btn" class="btn btn--primary">Install</button>
                <button id="dismiss-install-btn" class="btn btn--outline">Not Now</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>

    <!-- Firebase Service Layer -->
    <script src="firebase-service.js"></script>

    <script src="app.js"></script>

    <!-- Pomodoro Timer Module -->
    <script src="pomodoro.js"></script>

    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const dismissInstallBtn = document.getElementById('dismiss-install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the default install prompt
            e.preventDefault();
            deferredPrompt = e;

            // Show custom install prompt (after 3 seconds)
            setTimeout(() => {
                if (localStorage.getItem('installPromptDismissed') !== 'true') {
                    installPrompt?.classList.remove('hidden');
                }
            }, 3000);
        });

        installBtn?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User ${outcome} the install prompt`);
                deferredPrompt = null;
                installPrompt?.classList.add('hidden');
            }
        });

        dismissInstallBtn?.addEventListener('click', () => {
            installPrompt?.classList.add('hidden');
            localStorage.setItem('installPromptDismissed', 'true');
        });

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            installPrompt?.classList.add('hidden');
        });
    </script>
</body>
</html>
